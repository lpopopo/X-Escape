# X-Escape 编辑器工具使用指南

本文档详细介绍X-Escape项目中提供的13个编辑器工具的使用方法和应用场景。

## 目录
1. [场景搭建工具](#场景搭建工具)
2. [系统创建工具](#系统创建工具)
3. [诊断修复工具](#诊断修复工具)
4. [美术资源工具](#美术资源工具)
5. [实用工具](#实用工具)

---

## 场景搭建工具

### 1. PickupSceneSetup - 拾取场景一键搭建

**文件路径**: `Assets/Scripts/Editor/PickupSceneSetup.cs`

**菜单位置**: `Tools > Setup Pickup Scene`

**功能描述**: 自动创建完整的拾取场景，包括玩家、地面、相机、物品生成器、背包系统等所有必要组件。

#### 使用步骤

1. **创建新场景**
   ```
   File > New Scene
   ```

2. **运行工具**
   ```
   Tools > Setup Pickup Scene
   ```

3. **工具会自动创建**:
   - ✅ 主相机（正交相机，Size: 5）
   - ✅ 地面（Ground）
     - Position: (0, -4, 0)
     - Scale: (20, 1, 1)
     - 添加BoxCollider2D
   - ✅ 玩家（Player）
     - Position: (0, -3.5, 0)
     - 添加PlayerController脚本
     - 添加Rigidbody2D（重力：3）
     - 添加CapsuleCollider2D
     - 移动速度：5
   - ✅ 物品生成器（ItemSpawner）
     - 自动生成食物和伪装物品
     - 生成间隔可配置
   - ✅ 背包系统
     - Canvas（Screen Space - Overlay）
     - InventoryManager
     - InventoryUI（5个槽位）
   - ✅ 相机跟随（可选）

4. **保存场景**
   ```
   File > Save Scene As > PickupScene.unity
   ```

#### 配置选项

**在Hierarchy中配置**:
- **ItemSpawner**: 调整生成间隔、生成位置范围
- **PlayerController**: 调整移动速度（默认5）
- **Ground**: 调整地面大小和位置

#### 使用场景
- 创建新的拾取场景
- 快速原型测试
- 重置损坏的拾取场景

---

### 2. ViewSwitcherCreator - 视角切换系统创建

**文件路径**: `Assets/Scripts/Editor/ViewSwitcherCreator.cs`

**菜单位置**: `Tools > Create ViewSwitcher`

**功能描述**: 在车内场景创建视角切换系统，包括两个相机和切换按钮。

#### 使用步骤

1. **打开车内场景**
   ```
   Assets/Scenes/CarScene.unity
   ```

2. **运行工具**
   ```
   Tools > Create ViewSwitcher
   ```

3. **工具会自动创建**:
   - ✅ ViewSwitcher GameObject
     - 添加ViewSwitcher脚本
   - ✅ Interior Camera（车内视角相机）
     - 默认启用
     - Position可配置
   - ✅ Front Window Camera（车前窗视角相机）
     - 默认禁用
     - Position可配置
   - ✅ 切换按钮（SwitchViewButton）
     - 位置：屏幕右下角
     - 文本："切换视角"

4. **配置相机位置**
   - 在Scene视图中调整两个相机的位置
   - 确保两个视角都能看到想要的内容

#### Inspector配置

**ViewSwitcher组件**:
- **Interior View**: 车内视角相机（拖入Interior Camera）
- **Front Window View**: 车前窗视角相机（拖入Front Window Camera）
- **Switch Duration**: 切换动画时长（默认1秒）

**使用场景**:
- 在车内场景添加视角切换功能
- 创建多视角系统
- 增强游戏沉浸感

---

## 系统创建工具

### 3. ItemSystemCreator - 物品系统创建

**文件路径**: `Assets/Scripts/Editor/ItemSystemCreator.cs`

**菜单位置**: `Tools > Create Item System`

**功能描述**: 创建完整的物品管理系统，包括ItemManager、预制体文件夹结构。

#### 使用步骤

1. **运行工具**
   ```
   Tools > Create Item System
   ```

2. **工具会自动创建**:
   - ✅ ItemManager GameObject
     - 添加ItemManager脚本
     - DontDestroyOnLoad
   - ✅ Prefabs文件夹结构
     ```
     Assets/Prefabs/
     ├── Items/
     │   ├── Food/
     │   └── Disguise/
     ```
   - ✅ 示例物品预制体
     - FoodItem_Example
     - DisguiseItem_Example

3. **配置物品**
   - 在Inspector中编辑ItemManager
   - 添加物品到库存列表
   - 设置初始物品数量

#### 物品配置示例

**创建新食物**:
```
1. 复制 FoodItem_Example 预制体
2. 重命名（例如：Bread）
3. 编辑FoodItem组件：
   - Item Name: "面包"
   - Hunger Restore: 20（恢复饱腹度）
   - Icon: 拖入面包图标
4. 保存预制体
5. 在ItemManager中添加到库存
```

**创建新伪装物品**:
```
1. 复制 DisguiseItem_Example 预制体
2. 重命名（例如：Hat）
3. 编辑DisguiseItem组件：
   - Item Name: "帽子"
   - Disguise Restore: 20（恢复伪装度）
   - Icon: 拖入帽子图标
4. 保存预制体
5. 在ItemManager中添加到库存
```

#### 使用场景
- 初始化新项目的物品系统
- 重建物品管理器
- 创建物品预制体模板

---

### 4. InventoryUICreator - 背包UI创建

**文件路径**: `Assets/Scripts/Editor/InventoryUICreator.cs`

**菜单位置**: `Tools > Create Inventory UI`

**功能描述**: 创建背包UI系统，包括Canvas、背包槽位和物品显示。

#### 使用步骤

1. **运行工具**
   ```
   Tools > Create Inventory UI
   ```

2. **工具会自动创建**:
   - ✅ Canvas（Screen Space - Overlay）
   - ✅ Inventory Panel（背包面板）
     - 位置：屏幕左上角
     - 半透明黑色背景
   - ✅ Inventory Slots（物品槽位）
     - 默认5个槽位
     - 水平排列
     - 槽位大小：80x80
   - ✅ InventoryUI脚本
     - 自动关联所有槽位

3. **配置UI**
   - 调整Canvas Scaler设置
   - 修改槽位数量
   - 调整布局和间距

#### UI配置选项

**Inventory Panel**:
- **Position**: RectTransform位置（左上角：x=150, y=-100）
- **Size**: 槽位数量 × 槽位大小
- **Background Color**: 半透明黑色（可修改）

**Inventory Slot**:
- **Size**: 80x80像素
- **Spacing**: 10像素
- **Icon**: 物品图标（自动填充）
- **Count Text**: 物品数量（如果可堆叠）

#### 使用场景
- 在拾取场景添加背包UI
- 在车内场景显示库存
- 创建自定义物品界面

---

### 5. SimpleHoverTooltipCreator - 悬停提示框创建

**文件路径**: `Assets/Scripts/Editor/SimpleHoverTooltipCreator.cs`

**菜单位置**: `Tools > Create Hover Tooltip`

**功能描述**: 为GameObject添加悬停提示框功能。

#### 使用步骤

1. **选择GameObject**
   - 在Hierarchy中选择需要添加提示框的对象
   - 例如：物品、按钮、角色等

2. **运行工具**
   ```
   Tools > Create Hover Tooltip
   或右键GameObject > Create Hover Tooltip
   ```

3. **工具会自动添加**:
   - ✅ SimpleHoverTooltip组件
   - ✅ BoxCollider2D（如果没有碰撞体）
   - ✅ Tooltip Canvas（子对象）
   - ✅ Tooltip Text（显示文本）

4. **配置提示内容**
   - 在Inspector中编辑SimpleHoverTooltip
   - 设置Tooltip Text内容
   - 调整显示延迟和位置

#### 配置选项

**SimpleHoverTooltip组件**:
- **Tooltip Text**: 提示文本内容
- **Show Delay**: 显示延迟（秒，默认0.5秒）
- **Offset**: 提示框偏移（默认Y=50）
- **Background Color**: 背景颜色
- **Text Color**: 文字颜色

#### 示例配置

**物品提示**:
```
Tooltip Text: "食物 - 恢复饱腹度20"
Show Delay: 0.3秒
Offset: (0, 50)
```

**角色提示**:
```
Tooltip Text: "角色A\n饱腹度: 80/100\n伪装度: 60/100"
Show Delay: 0.5秒
Offset: (0, 100)
```

#### 使用场景
- 为物品添加说明
- 显示角色状态
- 添加按钮提示

---

## 诊断修复工具

### 6. DiagnosePickupScene - 拾取场景诊断

**文件路径**: `Assets/Scripts/Editor/DiagnosePickupScene.cs`

**菜单位置**: `Tools > Diagnose Pickup Scene`

**功能描述**: 自动检测拾取场景的配置问题，如缺失组件、层级错误等。

#### 使用步骤

1. **打开拾取场景**
   ```
   Assets/Scenes/PickupScene.unity
   ```

2. **运行诊断**
   ```
   Tools > Diagnose Pickup Scene
   ```

3. **查看Console输出**
   - ✅ 绿色：配置正确
   - ⚠️ 黄色警告：建议修复
   - ❌ 红色错误：必须修复

#### 检测项目

**必要组件检查**:
- Player是否存在
- PlayerController脚本是否添加
- Rigidbody2D是否配置
- Collider2D是否添加
- Ground是否存在
- ItemSpawner是否存在

**配置检查**:
- Player的Layer是否正确
- Collider的IsTrigger设置
- Rigidbody2D的Gravity Scale
- 相机的Projection模式

**层级检查**:
- PickupItem的Layer是否为"Item"
- Player的Layer是否为"Player"
- 碰撞矩阵配置

#### 常见问题和修复

**问题1**: "Player not found!"
```
修复: 创建Player GameObject，添加PlayerController组件
```

**问题2**: "Player missing Rigidbody2D!"
```
修复: 给Player添加Rigidbody2D组件
方法: Add Component > Physics 2D > Rigidbody 2D
配置: Gravity Scale = 3
```

**问题3**: "ItemSpawner not found!"
```
修复: 创建ItemSpawner GameObject
方法: Create Empty > 重命名为"ItemSpawner"
添加: ItemSpawner脚本
```

**问题4**: "PickupItem layer incorrect!"
```
修复: 修改物品Layer
方法: 选择PickupItem预制体 > Inspector > Layer > Item
```

#### 使用场景
- 拾取场景无法正常工作
- 物品拾取失败
- 玩家移动异常
- 定期检查场景配置

---

### 7. FixPickupCollision - 拾取碰撞修复

**文件路径**: `Assets/Scripts/Editor/FixPickupCollision.cs`

**菜单位置**: `Tools > Fix Pickup Collision`

**功能描述**: 自动修复拾取场景中的碰撞配置问题。

#### 使用步骤

1. **运行工具**
   ```
   Tools > Fix Pickup Collision
   ```

2. **工具会自动修复**:
   - ✅ Player的碰撞体设置
   - ✅ PickupItem的IsTrigger设置
   - ✅ Layer配置
   - ✅ 碰撞矩阵

3. **查看修复报告**
   - Console会显示修复的内容
   - 确认修复无误

#### 修复内容

**Player修复**:
```
- 添加CapsuleCollider2D（如果缺失）
- 设置IsTrigger = false
- 设置Layer = "Player"
```

**PickupItem修复**:
```
- 添加BoxCollider2D或CircleCollider2D
- 设置IsTrigger = true
- 设置Layer = "Item"
```

**碰撞矩阵修复**:
```
- Player与Item可以碰撞
- Player与Ground可以碰撞
- Item与Ground不碰撞（可选）
```

#### 使用场景
- 物品拾取不触发
- Player穿透物品
- 碰撞检测失败

---

### 8. VerifyViewSwitcherSetup - 视角切换系统验证

**文件路径**: `Assets/Scripts/Utilities/VerifyViewSwitcherSetup.cs`

**菜单位置**: （运行时验证，无菜单）

**功能描述**: 验证ViewSwitcher系统配置是否正确。

#### 使用方法

1. **自动验证**
   - 进入Play模式时自动运行
   - 检查ViewSwitcher配置

2. **手动验证**
   ```csharp
   // 在Inspector中点击"Verify Setup"按钮
   ```

3. **查看验证结果**
   - Console显示验证信息
   - 指出缺失或错误的配置

#### 验证项目

**组件检查**:
- ViewSwitcher脚本是否添加
- Interior Camera引用是否设置
- Front Window Camera引用是否设置
- Switch Button引用是否设置

**相机配置**:
- 两个相机是否都存在
- 相机的Enabled状态
- 相机的Depth设置

**按钮配置**:
- 按钮的OnClick事件是否绑定
- 事件是否绑定到ViewSwitcher.SwitchView()

#### 使用场景
- 视角切换不工作
- 相机切换卡顿
- 按钮无响应

---

### 9. DiagnoseViewSystem - 视角系统诊断

**文件路径**: `Assets/Scripts/Utilities/DiagnoseViewSystem.cs`

**使用方法**: 运行时诊断工具

**功能描述**: 诊断视角切换系统的运行时问题。

#### 使用步骤

1. **进入Play模式**

2. **触发诊断**
   - 尝试切换视角
   - 工具自动记录状态

3. **查看诊断信息**
   - Console输出当前状态
   - 显示相机激活情况
   - 显示按钮响应情况

#### 诊断输出示例

```
[ViewSystem] Current View: Interior
[ViewSystem] Interior Camera: Active
[ViewSystem] Front Window Camera: Inactive
[ViewSystem] Switch Button: Responding
```

#### 使用场景
- 视角切换失败
- 相机显示异常
- 运行时调试

---

## 美术资源工具

### 10. CarInteriorImageImporter - 车内图片导入

**文件路径**: `Assets/Scripts/Editor/CarInteriorImageImporter.cs`

**菜单位置**: `Tools > Import Car Interior Image`

**功能描述**: 导入车内背景图片并自动配置为Sprite。

#### 使用步骤

1. **准备图片**
   - 将车内背景图片放入Assets文件夹
   - 推荐分辨率：1920x1080或更高

2. **运行工具**
   ```
   Tools > Import Car Interior Image
   ```

3. **选择图片**
   - 在弹出的文件选择器中选择图片
   - 支持PNG、JPG格式

4. **工具会自动**:
   - ✅ 设置Texture Type为Sprite (2D and UI)
   - ✅ 设置Sprite Mode为Single
   - ✅ 设置Pixels Per Unit为100
   - ✅ 设置Filter Mode为Bilinear
   - ✅ 设置Max Size为2048
   - ✅ 创建Sprite GameObject并放入场景

5. **调整位置**
   - 在Scene视图中调整Sprite位置
   - 确保背景正确显示

#### 配置选项

**Import Settings**:
- **Texture Type**: Sprite (2D and UI)
- **Sprite Mode**: Single
- **Pixels Per Unit**: 100（可调整）
- **Filter Mode**: Bilinear（推荐）
- **Max Size**: 2048（可根据需要调整）

#### 使用场景
- 导入新的车内背景
- 更换车内视觉
- 快速配置Sprite设置

---

### 11. ApplyCustomSprites - 批量应用自定义精灵

**文件路径**: `Assets/Scripts/Editor/ApplyCustomSprites.cs`

**菜单位置**: `Tools > Apply Custom Sprites`

**功能描述**: 批量为多个GameObject应用自定义精灵图片。

#### 使用步骤

1. **准备精灵**
   - 将所有精灵图片导入到Assets文件夹
   - 确保图片已配置为Sprite

2. **选择目标对象**
   - 在Hierarchy中选择需要更换精灵的GameObject
   - 可以多选（按住Ctrl）

3. **运行工具**
   ```
   Tools > Apply Custom Sprites
   ```

4. **配置映射**
   - 在弹出的窗口中配置GameObject和Sprite的对应关系
   - 例如：
     ```
     CarOccupant1 → Character1_Sprite
     CarOccupant2 → Character2_Sprite
     ```

5. **应用**
   - 点击"Apply"按钮
   - 工具自动更换所有精灵

#### 批量配置示例

**更换角色精灵**:
```
选择: 所有CarOccupant对象
配置:
  - Occupant1 → Assets/Art/Sprites/Character1.png
  - Occupant2 → Assets/Art/Sprites/Character2.png
  - Occupant3 → Assets/Art/Sprites/Character3.png
应用: 点击Apply
```

**更换物品图标**:
```
选择: 所有ItemIcon对象
配置:
  - FoodIcon1 → Assets/Art/Icons/Bread.png
  - FoodIcon2 → Assets/Art/Icons/Water.png
  - DisguiseIcon1 → Assets/Art/Icons/Hat.png
应用: 点击Apply
```

#### 使用场景
- 批量更换角色精灵
- 更新物品图标
- 美术资源迭代

---

### 12. ApplyPlayerSprite - 应用玩家精灵

**文件路径**: `Assets/Scripts/Editor/ApplyPlayerSprite.cs`

**菜单位置**: `Tools > Apply Player Sprite`

**功能描述**: 为拾取场景的Player GameObject应用精灵。

#### 使用步骤

1. **打开拾取场景**
   ```
   Assets/Scenes/PickupScene.unity
   ```

2. **准备玩家精灵**
   - 导入玩家精灵图片
   - 配置为Sprite

3. **运行工具**
   ```
   Tools > Apply Player Sprite
   ```

4. **选择精灵**
   - 在弹出的窗口中选择玩家精灵
   - 点击"Apply"

5. **工具会自动**:
   - ✅ 为Player添加SpriteRenderer组件（如果缺失）
   - ✅ 设置Sprite
   - ✅ 调整Sorting Layer和Order in Layer
   - ✅ 设置合适的Scale

#### 配置选项

**SpriteRenderer设置**:
- **Sprite**: 选择的玩家精灵
- **Sorting Layer**: "Player"（自动创建）
- **Order in Layer**: 10（确保在其他层之上）
- **Color**: 白色（可自定义）

#### 使用场景
- 更换玩家外观
- 测试不同角色精灵
- 快速配置Player视觉

---

## 实用工具

### 13. CameraFitToSceneEditor - 相机自适应场景

**文件路径**: `Assets/Scripts/Editor/CameraFitToSceneEditor.cs`

**菜单位置**: `Tools > Camera Fit To Scene`

**功能描述**: 自动调整相机大小以适应场景背景。

#### 使用步骤

1. **打开场景**
   - 打开需要调整相机的场景

2. **选择主相机**
   - 在Hierarchy中选择Main Camera

3. **运行工具**
   ```
   Tools > Camera Fit To Scene
   ```

4. **工具会自动**:
   - ✅ 检测场景中的背景Sprite
   - ✅ 计算合适的相机尺寸
   - ✅ 调整Camera.orthographicSize
   - ✅ 调整相机Position

5. **微调（如需要）**
   - 手动调整Orthographic Size
   - 调整相机位置

#### 计算逻辑

```
背景尺寸 = Sprite的Bounds大小
相机高度 = 背景高度 / 2
相机宽度 = 相机高度 × 屏幕宽高比

Orthographic Size = 相机高度
```

#### 使用场景
- 更换场景背景后调整相机
- 适配不同分辨率的背景
- 快速配置相机视野

---

### 14. SceneSwitchPreviewTool - 场景切换预览

**文件路径**: `Assets/Scripts/Editor/SceneSwitchPreviewTool.cs`

**菜单位置**: `Tools > Preview Scene Switch`

**功能描述**: 在编辑器中预览场景切换效果。

#### 使用步骤

1. **打开工具窗口**
   ```
   Tools > Preview Scene Switch
   ```

2. **配置场景**
   - From Scene: 起始场景
   - To Scene: 目标场景
   - Transition Type: 切换效果（淡入淡出/滑动等）

3. **预览切换**
   - 点击"Preview"按钮
   - 观察切换动画效果

4. **调整参数**
   - Transition Duration: 切换时长
   - Fade Color: 淡入淡出颜色
   - Ease Type: 缓动类型

5. **应用到项目**
   - 点击"Apply Settings"
   - 保存配置到SceneTransitionManager

#### 配置选项

**Transition Settings**:
- **Duration**: 切换时长（秒，默认1秒）
- **Type**: 切换类型
  - Fade（淡入淡出）
  - Slide（滑动）
  - Scale（缩放）
- **Ease**: 缓动函数
  - Linear（线性）
  - EaseInOut（缓入缓出）
  - EaseIn（缓入）
  - EaseOut（缓出）

#### 使用场景
- 调整场景切换效果
- 测试不同转场动画
- 优化用户体验

---

## 工具开发指南

### 创建自定义编辑器工具

如果需要创建新的编辑器工具，可以参考以下模板：

```csharp
using UnityEngine;
using UnityEditor;

namespace XEscape.Editor
{
    public class MyCustomTool : EditorWindow
    {
        [MenuItem("Tools/My Custom Tool")]
        public static void ShowWindow()
        {
            GetWindow<MyCustomTool>("My Custom Tool");
        }

        private void OnGUI()
        {
            GUILayout.Label("My Custom Tool", EditorStyles.boldLabel);

            if (GUILayout.Button("Execute"))
            {
                ExecuteTool();
            }
        }

        private void ExecuteTool()
        {
            // 工具逻辑
            Debug.Log("Tool executed!");
        }
    }
}
```

### 工具开发最佳实践

1. **使用MenuItem特性**
   ```csharp
   [MenuItem("Tools/My Tool")]
   public static void MyTool() { }
   ```

2. **提供撤销支持**
   ```csharp
   Undo.RecordObject(target, "Undo My Action");
   // 修改操作
   Undo.FlushUndoRecordObjects();
   ```

3. **显示进度条**
   ```csharp
   EditorUtility.DisplayProgressBar("Processing", "Please wait...", progress);
   // 完成后
   EditorUtility.ClearProgressBar();
   ```

4. **输出日志**
   ```csharp
   Debug.Log("Info message");
   Debug.LogWarning("Warning message");
   Debug.LogError("Error message");
   ```

5. **确认对话框**
   ```csharp
   if (EditorUtility.DisplayDialog("Confirm", "Are you sure?", "Yes", "No"))
   {
       // 用户点击了Yes
   }
   ```

---

## 常见问题

### Q1: 工具菜单找不到？
**A**:
1. 确保脚本在`Editor`文件夹中
2. 检查命名空间是否正确
3. 重启Unity Editor

### Q2: 工具运行报错？
**A**:
1. 查看Console的错误信息
2. 确保场景中存在必要的GameObject
3. 检查脚本引用是否正确

### Q3: 工具执行后无效果？
**A**:
1. 检查是否选择了正确的GameObject
2. 确认场景已保存
3. 尝试重新运行工具

### Q4: 如何撤销工具操作？
**A**:
1. 使用Ctrl+Z（Windows）或Cmd+Z（Mac）
2. 如果工具支持Undo系统，可以撤销
3. 否则需要手动恢复或从版本控制恢复

### Q5: 工具可以批量处理吗？
**A**:
- 部分工具支持多选批量处理（如ApplyCustomSprites）
- 其他工具需要单独运行多次
- 可以编写自定义脚本实现批量处理

---

## 附录：快捷键列表

| 功能 | 快捷键（Windows） | 快捷键（Mac） |
|------|------------------|--------------|
| 打开Tools菜单 | Alt+T | Cmd+T |
| 撤销 | Ctrl+Z | Cmd+Z |
| 重做 | Ctrl+Y | Cmd+Shift+Z |
| 保存场景 | Ctrl+S | Cmd+S |
| 进入Play模式 | Ctrl+P | Cmd+P |

---

**文档版本**: 1.0
**更新日期**: 2026-01-25
**工具总数**: 13个
**适用Unity版本**: 2020.3+
